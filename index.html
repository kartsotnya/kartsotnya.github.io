<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description" content="">
    <meta name="author" content="">
    <!--link rel="shortcut icon" sizes="25x25" href="assets/icon.png"-->
    <title>map100 | Безкоштовні картматеріали для військових</title>

    <link rel="stylesheet" href="assets/bootstrap-3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/font-awesome-4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/leaflet-0.7.3/leaflet.css">
    <link rel="stylesheet" href="assets/leaflet.groupedlayercontrol/leaflet.groupedlayercontrol.min.css">
    <link rel="stylesheet" href="assets/leaflet-control.geocoder/Control.Geocoder.css">

    <style>
	
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 675px;
        }		
		
		h6 {
			text-align: center;
		}
				
		@media (min-width: 1800px) {
		  .container {
			width: 95%;
		  }
		}
		
		#sf100,sf50,sf25,sf10 {
			max-width: 100%;
		}
		
		#geocode-selector {
			position: absolute;
			left: 10px;
			bottom: 10px;
		}

		#geocode-selector .selected {
			background-color: #0078A8;
		}		

		
    </style>

</head>

<body>
	<div class="container">	
	
	
		<div class="row">
			<div class="col-xs-6 col-md-4">
			<img src="assets/logo.png" /> 
		</div>
		  
		<div class="col-xs-12 col-md-8">
			<h2>Безкоштовні картматеріали для військових</h2>
			<h5>Оберіть потрібні вам номенклатури, натискаючи по них курсором мишки. Повторне натискання знімає позначку. Після того як закінчите вибір, скористайтеся посиланням, розташованим нижче, для відкриття форми замовлення. Відповідне поле форми вже буде попередньо заповнене для вашої зручності.</h5>
		</div>
		</div>
	
        <div id="hr-divider">
            <hr>
        </div>
		
        <div id="map" class="centerish"></div>
		
		</br>
		
		<div class="row">
		  <div class="col-md-3">
				<textarea class="form-control" value="" rows="1" id="sf100" placeholder="1 : 100 000"></textarea>  
		  </div>  
		  <div class="col-md-3">
				<textarea class="form-control" value="" rows="1" id="sf50" placeholder="1 : 50 000"></textarea>  
		  </div>  
		  <div class="col-md-3">
				<textarea class="form-control" value="" rows="1" id="sf25" placeholder="1 : 25 000"></textarea>  
		  </div>  
		  <div class="col-md-3">
				<textarea class="form-control" value="" rows="1" id="sf10" placeholder="1 : 10 000"></textarea>  
		  </div>
		</div>

		</br>
				
		<div class="row">
		  <div class="col-md-6">
				<textarea class="form-control hide" value="" rows="1" id="sfAll" style="width: 100%;"></textarea>  
		  </div>  
		  <div class="col-md-3">
				<label style="font-size: 12px; font-weight: normal;">Кількість обраних номенклатурних листів:</label>
				<label style="font-size: 12px; font-weight: normal;" id="selectedCount">0</label>
		  </div>  		 
		  <div class="col-md-3">
				<button type="button" id="sendForm" class="btn btn-default pull-right">Замовити</button> 
				<button type="button" id="clearForm" class="btn btn-default pull-right" style="margin-right: 20px;">Скасувати вибір</button> 
		  </div>  
		</div>		

        <div id="hr-divider">
            <hr>
        </div>
		<h6>@ 2015 <a href="http://map100.org.ua">http://map100.org.ua</a></h6>
	
		<!--form>
		  <div class="form-group">
			<label style="font-size: 12px;">Кількість обраних номенклатурних листів:</label>
			<label style="font-size: 12px;" id="selectedCount">0</label>
			<textarea class="form-control" value="" rows="2" id="selectedFeatures"></textarea>
		  </div>
		</form-->

</div>		
	
		
    <script src="assets/jquery-1.11.3.min.js"></script>
    <script src="assets/bootstrap-3.3.2/js/bootstrap.min.js"></script>
    <script src="assets/leaflet-0.7.3/leaflet.js"></script>
    <script src="assets/leaflet.groupedlayercontrol/leaflet.groupedlayercontrol.min.js"></script>
    <script src="assets/bootbox.min.js"></script>
    <script src="assets/leaflet.hash/leaflet.hash.js"></script>
    <script src="assets/leaflet-control.geocoder/Control.Geocoder.js"></script>
	<script src="assets/Google.js"></script>

    <script>
	
	
        // add OpenStreetMap layer
        var layerOSM = new L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
			zIndex: 1,
            attribution: '&copy; Map Data <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        });

		// add MapBoxImagery layer
        var layerMapBoxImagery = new L.tileLayer('http://{s}.tiles.mapbox.com/v4/openstreetmap.map-inh7ifmo/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoib3BlbnN0cmVldG1hcCIsImEiOiJhNVlHd29ZIn0.ti6wATGDWOmCnCYen-Ip7Q', {
            maxZoom: 17,
			zIndex: 1,
            attribution: 'Data &copy; <a href="http://www.openstreetmap.org/copyright/en">OSM</a> contributors (ODbL), rendering ' +
                '<a href="http://giscience.uni-hd.de/" target="_blank">GIScience Research Group @ University of Heidelberg</a>'
        });		

		// Bing Aerial
		var BingLayer = L.TileLayer.extend({
			getTileUrl: function(tilePoint) {
				this._adjustTilePoint(tilePoint);
				return L.Util.template(this._url, {
					s: this._getSubdomain(tilePoint),
					q: this._quadKey(tilePoint.x, tilePoint.y, this._getZoomForUrl())
				});
			},
			_quadKey: function(x, y, z) {
				var quadKey = [];
				for (var i = z; i > 0; i--) {
					var digit = '0';
					var mask = 1 << (i - 1);
					if ((x & mask) != 0) {
						digit++;
					}
					if ((y & mask) != 0) {
						digit++;
						digit++;
					}
					quadKey.push(digit);
				}
				return quadKey.join('');
			}
		});	
	
		var layerBA = new BingLayer('http://t{s}.tiles.virtualearth.net/tiles/a{q}.jpeg?g=2732', {
			maxZoom: 19,
			zIndex: 1,
			subdomains: ['0', '1', '2', '3', '4'],
			attribution: '&copy; <a href="http://bing.com/maps">Bing Maps</a>'
		});	
	
		// Google layers
		var layerGoogleRoadmap = new L.Google('ROADMAP');
		var layerGoogleSat = new L.Google('SATELLITE');
	

	
        // initialize map
        var map = new L.Map('map', {
            minZoom: 6,
            maxZoom: 18,
			layers: [layerOSM]
        });

        // add scale control
        L.control.scale().addTo(map);
		
		//add hash control
		var hash = new L.Hash(map);
	
		// add geocoder control
		L.Control.geocoder({position: "topleft"}).addTo(map);
	
	

        // add topo100 layer		
        var topo100 = L.geoJson(null, {
            style: function(feature) {
                return {
                    color: "#C96A7B",
                    fill: true,
                    opacity: 1,
                    fillOpacity: 0.001,
                    weight: 3
                }
            },
            onEachFeature: function(feature, layer_topo100) {
                layer_topo100.on({
                    click: function(e) {
                        var layer_topo100 = e.target;

                        if (layer_topo100.options.color == '#00FFFF') {
                            topo100.resetStyle(e.target);
							e.target.feature.properties.selected = false;
							//console.log("deselected " + feature.properties.name);
                        } else {
                            layer_topo100.setStyle({
                                weight: 3,
                                color: "#00FFFF",
                                opacity: 1,
                                fillOpacity: 0.1
                            });
							//console.log("selected " + feature.properties.name);
							e.target.feature.properties.selected = true;
							//$('#selectedFeatures').text( feature.properties.name );
                        }
			
						getAllElements100();
					
                        if (!L.Browser.ie && !L.Browser.opera) {
                            layer_topo100.bringToFront();
                        }
                    }
                });
				
            }
        });
        $.getJSON("data/UA100000.geojson", function(data) {
            topo100.addData(data);
        });

        topo100.addTo(map);
	
	
	
        // add topo50 layer		
        var topo50 = L.geoJson(null, {
            style: function(feature) {
                return {
                    color: "#176BBE",
                    fill: true,
                    opacity: 1,
                    fillOpacity: 0.001,
                    weight: 2
                }
            },
            onEachFeature: function(feature, layer_topo50) {
                layer_topo50.on({
                    click: function(e) {
                        var layer_topo50 = e.target;

                        if (layer_topo50.options.color == '#00FFFF') {
                            topo50.resetStyle(e.target);
							e.target.feature.properties.selected = false;
							//console.log("deselected " + feature.properties.name);
                        } else {
                            layer_topo50.setStyle({
                                weight: 3,
                                color: "#00FFFF",
                                opacity: 1,
                                fillOpacity: 0.1
                            });
							//console.log("selected " + feature.properties.name);
							e.target.feature.properties.selected = true;
							//$('#selectedFeatures').text( feature.properties.name );
                        }
			
						getAllElements50();
					
                        if (!L.Browser.ie && !L.Browser.opera) {
                            layer_topo50.bringToFront();
                        }
                    }
                });
				
            }
        });
        $.getJSON("data/UA50000.geojson", function(data) {
            topo50.addData(data);
        });	
	
	
        // add topo25 layer		
        var topo25 = L.geoJson(null, {
            style: function(feature) {
                return {
                    color: "#8E381D",
                    fill: true,
                    opacity: 1,
                    fillOpacity: 0.001,
                    weight: 1
                }
            },
            onEachFeature: function(feature, layer_topo25) {
                layer_topo25.on({
                    click: function(e) {
                        var layer_topo25 = e.target;

                        if (layer_topo25.options.color == '#00FFFF') {
                            topo25.resetStyle(e.target);
							e.target.feature.properties.selected = false;
							//console.log("deselected " + feature.properties.name);
                        } else {
                            layer_topo25.setStyle({
                                weight: 3,
                                color: "#00FFFF",
                                opacity: 1,
                                fillOpacity: 0.1
                            });
							//console.log("selected " + feature.properties.name);
							e.target.feature.properties.selected = true;
							//$('#selectedFeatures').text( feature.properties.name );
                        }
			
						getAllElements25();
					
                        if (!L.Browser.ie && !L.Browser.opera) {
                            layer_topo25.bringToFront();
                        }
                    }
                });
				
            }
        });
        $.getJSON("data/UA25000.geojson", function(data) {
            topo25.addData(data);
        });		
		
	
        // add topo10 layer		
        var topo10 = L.geoJson(null, {
            style: function(feature) {
                return {
                    color: "#F6626A",
                    fill: true,
                    opacity: 1,
                    fillOpacity: 0.001,
                    weight: 1
                }
            },
            onEachFeature: function(feature, layer_topo10) {
                layer_topo10.on({
                    click: function(e) {
                        var layer_topo10 = e.target;

                        if (layer_topo10.options.color == '#00FFFF') {
                            topo10.resetStyle(e.target);
							e.target.feature.properties.selected = false;
							//console.log("deselected " + feature.properties.name);
                        } else {
                            layer_topo10.setStyle({
                                weight: 3,
                                color: "#00FFFF",
                                opacity: 1,
                                fillOpacity: 0.1
                            });
							//console.log("selected " + feature.properties.name);
							e.target.feature.properties.selected = true;
							//$('#selectedFeatures').text( feature.properties.name );
                        }
			
						getAllElements10();
					
                        if (!L.Browser.ie && !L.Browser.opera) {
                            layer_topo10.bringToFront();
                        }
                    }
                });
				
            }
        });
        $.getJSON("data/UA10000.geojson", function(data) {
            topo10.addData(data);
        });		
		
	
		map.setView([48.4947,39.0563], 7);

		

        var layerUA100000 = new L.tileLayer('http://134.249.136.27/map100/UA100000/{z}/{x}/{y}.png', { 
			zIndex: 5
		});		
        var layerUA50000 = new L.tileLayer('http://134.249.136.27/map100/UA50000/{z}/{x}/{y}.png', { 
			zIndex: 5
		});			
        var layerUA25000 = new L.tileLayer('http://134.249.136.27/map100/UA25000/{z}/{x}/{y}.png', { 
			zIndex: 5
		});			
        var layerUA10000 = new L.tileLayer('http://134.249.136.27/map100/UA10000/{z}/{x}/{y}.png', { 
			zIndex: 5
		});			
		
		
layerUA100000.addTo(map);		
		
		
		map.on("overlayadd", function(e) {
		  if (e.layer === topo100) {
			map.setZoom(7);
			layerUA100000.addTo(map);
			
			map.removeLayer(layerUA50000);
			map.removeLayer(layerUA25000);
			map.removeLayer(layerUA10000);
		  }
		  if (e.layer === topo50) {
			map.setZoom(9); 
			layerUA50000.addTo(map);
			
			map.removeLayer(layerUA100000);
			map.removeLayer(layerUA25000);
			map.removeLayer(layerUA10000);			
		  }
		  if (e.layer === topo25) {
			map.setZoom(11);
			layerUA25000.addTo(map);

			map.removeLayer(layerUA50000);
			map.removeLayer(layerUA100000);
			map.removeLayer(layerUA10000);			
		  }
		  if (e.layer === topo10) {
			map.setZoom(11); 
			layerUA10000.addTo(map);
			
			map.removeLayer(layerUA50000);
			map.removeLayer(layerUA25000);
			map.removeLayer(layerUA100000);			
		  }  
		});



	/*
		map.on("dragend", function(e) {
		  console.log(map.getCenter().lat+","+map.getCenter().lng);
		  console.log(map.getZoom());
		});
	*/

	
		// Layer Control
		var baseLayers = {
			"OpenStreetMap": layerOSM,
			"MapBox Imagery": layerMapBoxImagery,
			"Bing Aerial": layerBA,
			"Google Roadmap": layerGoogleRoadmap,
			"Google Satellite": layerGoogleSat
		};
		
		var overlayLayers = {
		  "Номенклатурні рамки:": {
			"&nbsp1 : 100 000": topo100,
			"&nbsp1 : 50 000": topo50,
			"&nbsp1 : 25 000": topo25,
			"&nbsp1 : 10 000": topo10
		  }
		};		
	
		L.control.groupedLayers(baseLayers, overlayLayers, {collapsed: false, exclusiveGroups: ["Номенклатурні рамки:"]}).addTo(map);	
	

			String.prototype.replaceAll = function(search, replace){
			  return this.split(search).join(replace);
			}	
	
	
		function getAllElements100() {
			var selectedFeatureName = [];
            $.each(map._layers, function (ml) {
                if (map._layers[ml].feature && map._layers[ml].feature.properties.selected === true) {
					selectedFeatureName.push(map._layers[ml].feature.properties.name);
                }
            });
            //console.log(selectedFeatureName);
			//$('#sf100').text( selectedFeatureName );
			$('#sf100').text( selectedFeatureName.toString().replaceAll(',',', ') );
			getAllElements();
		};		
		
		function getAllElements50() {
			var selectedFeatureName = [];
            $.each(map._layers, function (ml) {
                if (map._layers[ml].feature && map._layers[ml].feature.properties.selected === true) {
					selectedFeatureName.push(map._layers[ml].feature.properties.name);
                }
            });
            //console.log(selectedFeatureName);
			//$('#sf50').text( selectedFeatureName );
			$('#sf50').text( selectedFeatureName.toString().replaceAll(',',', ') );
			getAllElements();
		};		
		
		function getAllElements25() {
			var selectedFeatureName = [];
            $.each(map._layers, function (ml) {
                if (map._layers[ml].feature && map._layers[ml].feature.properties.selected === true) {
					selectedFeatureName.push(map._layers[ml].feature.properties.name);
                }
            });
            //console.log(selectedFeatureName);
			//$('#sf25').text( selectedFeatureName );
			$('#sf25').text( selectedFeatureName.toString().replaceAll(',',', ') );
			getAllElements();
		};		
		
		function getAllElements10() {
			var selectedFeatureName = [];
            $.each(map._layers, function (ml) {
                if (map._layers[ml].feature && map._layers[ml].feature.properties.selected === true) {
					selectedFeatureName.push(map._layers[ml].feature.properties.name);
                }
            });
            //console.log(selectedFeatureName);
			//$('#sf10').text( selectedFeatureName );
			$('#sf10').text( selectedFeatureName.toString().replaceAll(',',', ') );
			getAllElements();
		};
		
		function getAllElements() {

     		$('#sfAll').text( '' );
			var s1 = $("#sf100").text();
			var s2 = $("#sf50").text();
			var s3=  $("#sf25").text();
			var s4 = $("#sf10").text();
			var d = [];
			var all;
			all = d.concat(s1,s2,s3,s4);	
			all = all.toString().replace(",,,", ","); 	
			all = all.toString().replace(",,", ","); 	
			if ($("#sf10").text().length == 0) {
				all = all.slice(0,-1);
			}			
			if ($("#sf100").text().length == 0) {
				all = all.substr(1);
			}
		
			$('#sfAll').text( all );
			
			var count;
			if ( $("#sfAll").text() ) {
				count = all.match(/[A-Z]/g).length;
			} else 	{
				count = 0;
			}	
			
			$('#sfAll').text( $('#sfAll').text().toString().replaceAll(', ',',') );
			$('#sfAll').text( $('#sfAll').text().toString().replaceAll(',',', ') );

			$('#selectedCount').text( count );
		
		};
		
		$('#sendForm').on('click', function(e) {
			if ( !$("#sfAll").text() ) {
				bootbox.alert("Оберіть потрібні вам номенклатури, натискаючи по них курсором мишки.");
			} else {		
				window.open("https://docs.google.com/forms/d/1DAJ0hitiiyzqGjRds6NHyISHKiqFq_Hx7HfM0BrVcDs/viewform?entry.1160221620=" + $("#sfAll").text());
			}
 		});			
		
		
		$('#clearForm').on('click', function(e) {
			window.location.reload(); // page reload :(
			/*
			$('#selectedCount').text( '0' );
			$('#sfAll').text( '' );
			$('#sf100').text( '' );
			$('#sf50').text( '' );
			$('#sf25').text( '' );
			$('#sf10').text( '' );
			
			topo100.setStyle({
				color: "red",
				fill: true,
				opacity: 1,
				fillOpacity: 0.001,
				weight: 1
			});			
			topo50.setStyle({
				color: "red",
				fill: true,
				opacity: 1,
				fillOpacity: 0.001,
				weight: 1
			});			
			topo25.setStyle({
				color: "red",
				fill: true,
				opacity: 1,
				fillOpacity: 0.001,
				weight: 1
			});			
			topo10.setStyle({
				color: "red",
				fill: true,
				opacity: 1,
				fillOpacity: 0.001,
				weight: 1
			});
		
            $.each(map._layers, function (ml) {
                if (map._layers[ml].feature && map._layers[ml].feature.properties.selected === true) {
					map._layers[ml].feature.properties.selected = false;
				}
            });				
			
			*/
 		});		

		
		
    </script>
</body>

</html>